<?php
namespace App\Http\Middleware;use Closure;use Illuminate\Http\Request;use Symfony\Component\HttpFoundation\Response;class ContentSecurityPolicy{public function handle(Request $request,Closure $next):Response{$response=$next($request);if(!$response->headers->has('Content-Security-Policy')){$allowUnsafeEval=(bool)env('CSP_ALLOW_UNSAFE_EVAL',false)||(bool)config('nativephp-internal.running',false);$scriptSrc=["'self'","'unsafe-inline'",'https://cdn.tailwindcss.com','https://cdn.jsdelivr.net','https://unpkg.com',];if($allowUnsafeEval){$scriptSrc[]="'unsafe-eval'";}$policy=implode('; ',["default-src 'self'",'script-src '.implode(' ',$scriptSrc),"style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.bunny.net","font-src 'self' data: https://fonts.gstatic.com https://fonts.googleapis.com https://fonts.bunny.net","img-src 'self' data: blob: https:","connect-src 'self' http://127.0.0.1:* ws://127.0.0.1:* https:","frame-ancestors 'self'","object-src 'none'","base-uri 'self'",]);$response->headers->set('Content-Security-Policy',$policy);}return $response;}}