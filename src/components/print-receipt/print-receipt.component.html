<!-- Modal UI Wrapper (Hanya untuk Tampilan Layar) -->
<div class="fixed inset-0 z-40 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 no-print">
  <div class="bg-gray-100 p-6 rounded-lg shadow-2xl max-w-4xl w-full flex flex-col max-h-[95vh]">
    <!-- Receipt Preview (Tampilan Layar) - scrollable on mobile -->
    <div class="bg-white p-8 border border-gray-300 receipt-preview-wrapper">
      @if(paymentDetails(); as details) {
        <div class="receipt-content">
          <!-- Header -->
          <div class="flex justify-between items-start pb-4 border-b-2 border-black">
            <div class="flex items-center gap-4">
              @if(details.company.logo_url) {
              <img [src]="details.company.logo_url" alt="Company Logo" class="h-16 w-16 object-contain">
              }
              <div>
                <h1 class="text-2xl font-bold text-black">{{ details.company.nama }}</h1>
                <p class="text-xs text-black">{{ details.company.alamat }}</p>
                <p class="text-xs text-black">Telp: {{ details.company.telepon }} | Email: {{ details.company.email }}</p>
              </div>
            </div>
            <div class="text-right">
              <h2 class="text-3xl font-bold text-black">KUITANSI</h2>
              <p class="text-sm text-black mt-1">No: {{ details.payment.receipt_no }}</p>
            </div>
          </div>

          <!-- Body -->
          <div class="mt-8 text-sm space-y-4 text-black">
            <div class="flex">
              <span class="w-48">Telah Diterima Dari</span>
              <span class="font-semibold">: {{ details.customer.name }}</span>
            </div>
            <div class="flex items-start">
              <span class="w-48">Uang Sejumlah</span>
              <span class="font-semibold">:
                <span class="italic capitalize bg-gray-100 px-2 py-1 border-dashed border-b border-gray-400">
                    {{ amountInWords() }}
                </span>
              </span>
            </div>
            <div class="flex">
              <span class="w-48">Untuk Pembayaran</span>
              <span class="font-semibold">: {{ details.payment.payment_for }} Kavling {{ details.lot.block }}/{{ details.lot.lot_number }}</span>
            </div>
          </div>

          <!-- Amount Box & Signature -->
          <div class="mt-12 flex justify-between items-end">
            <div class="border-2 border-black p-4">
              <span class="text-lg font-bold text-black">Rp {{ details.payment.amount | currency:'':'':'1.0-0' }}</span>
            </div>
            <div class="text-center text-sm w-56 text-black">
              <p>{{ details.company.alamat.split(',').pop()?.trim() || 'Jakarta' }}, {{ details.payment.payment_date | date:'dd MMMM yyyy' }}</p>
              <div class="h-16"></div> <!-- Spacer for signature -->
              <p class="font-semibold border-t border-black pt-1">{{ details.company.ttd_admin_nama || 'Admin' }}</p>
            </div>
          </div>

          <!-- Footer -->
          @if(details.company.footer_cetak) {
              <div class="mt-8 pt-4 border-t text-center text-xs text-black">
                  <p>{{ details.company.footer_cetak }}</p>
              </div>
          }
        </div>
      }
    </div>

    <!-- Action Buttons -->
    <div class="mt-6 flex justify-end gap-4 flex-shrink-0 print:hidden">
      <button (click)="close.emit()" class="px-6 py-2...">Tutup</button>
      <button (click)="print()" class="px-6 py-2...">Cetak Kuitansi</button>
    </div>
  </div>
</div>

<!-- Print Only Container -->
<div class="print-container">
  @if(paymentDetails(); as details) {
    <div id="receiptContent" class="receipt-content bg-white p-8">
      <!-- Header -->
      <div class="flex justify-between items-start pb-4 border-b-2 border-black">
        <div class="flex items-center gap-4">
          @if(details.company.logo_url) {
          <img
    [src]="details.company.logo_url ? details.company.logo_url.replace('/storage/', '/native-img/') : 'assets/logo-app.png'"
    alt="Company Logo"
    class="h-16 w-16 object-contain"
    (error)="this.src='assets/logo-app.png'">
          }
          <div>
            <h1 class="text-2xl font-bold text-black">{{ details.company.nama }}</h1>
            <p class="text-xs text-black">{{ details.company.alamat }}</p>
            <p class="text-xs text-black">Telp: {{ details.company.telepon }} | Email: {{ details.company.email }}</p>
          </div>
        </div>
        <div class="text-right">
          <h2 class="text-3xl font-bold text-black">KUITANSI</h2>
          <p class="text-sm text-black mt-1">No: {{ details.payment.receipt_no }}</p>
        </div>
      </div>

      <!-- Body -->
      <div class="mt-8 text-sm space-y-4 text-black">
        <div class="flex">
          <span class="w-48">Telah Diterima Dari</span>
          <span class="font-semibold">: {{ details.customer.name }}</span>
        </div>
        <div class="flex items-start">
          <span class="w-48">Uang Sejumlah</span>
          <span class="font-semibold">:
            <span class="italic capitalize bg-gray-100 px-2 py-1 border-dashed border-b border-gray-400">
                {{ amountInWords() }}
            </span>
          </span>
        </div>
        <div class="flex">
          <span class="w-48">Untuk Pembayaran</span>
          <span class="font-semibold">: {{ details.payment.payment_for }} Kavling {{ details.lot.block }}/{{ details.lot.lot_number }}</span>
        </div>
      </div>

      <!-- Amount Box & Signature -->
      <div class="mt-12 flex justify-between items-end">
        <div class="border-2 border-black p-4">
          <span class="text-lg font-bold text-black">Rp {{ details.payment.amount | currency:'':'':'1.0-0' }}</span>
        </div>
        <div class="text-center text-sm w-56 text-black">
          <p>{{ details.company.alamat.split(',').pop()?.trim() || 'Jakarta' }}, {{ details.payment.payment_date | date:'dd MMMM yyyy' }}</p>
          <div class="h-16"></div> <!-- Spacer for signature -->
          <p class="font-semibold border-t border-black pt-1">{{ details.company.ttd_admin_nama || 'Admin' }}</p>
        </div>
      </div>

      <!-- Footer -->
      @if(details.company.footer_cetak) {
          <div class="mt-8 pt-4 border-t text-center text-xs text-black">
              <p>{{ details.company.footer_cetak }}</p>
          </div>
      }
    </div>
  }
</div>
